const l=new WeakMap,r=new WeakMap,m={attributes:!0,childList:!0,characterData:!0,subtree:!0},g=e=>{const t=e;return t.accessibleNameRef?v(e):t.accessibleName?t.accessibleName:void 0},v=e=>{var a;const t=((a=e.accessibleNameRef)==null?void 0:a.split(" "))??[],c=e.getRootNode();let s="";return t.forEach((n,o)=>{const i=c.querySelector(`[id='${n}']`),b=`${i&&i.textContent?i.textContent:""}`;b&&(s+=b,o<t.length-1&&(s+=" "))}),s},f=e=>{const t=new Set;u(e).forEach(n=>{t.add(n)});const s=e.accessibleNameRef;return((s==null?void 0:s.split(" "))??[]).forEach(n=>{const o=h(e,n);o&&t.add(o)}),Array.from(t)},u=e=>{const t=e.getRootNode().querySelectorAll(`[for="${e.id}"]`);return Array.from(t)},h=(e,t)=>e.getRootNode().querySelector(`[id='${t}']`),A=e=>{const t=[];if(u(e).forEach(s=>{const a=s.textContent;a&&t.push(a)}),t.length)return t.join(" ")},k=e=>c=>{if(!(c&&c.type==="property"&&c.name==="accessibleNameRef"))return;const s=r.get(e);if(!s)return;const a=s.observedElements,n=f(e);a.forEach(o=>{n.includes(o)||d(s,o)}),n.forEach(o=>{a.includes(o)||(E(s,o),s.observedElements.push(o))}),s==null||s.callback()},p=(e,t)=>{if(r.has(e))return;const c=f(e),s=k(e),a={host:e,observedElements:c,callback:t,invalidationCallback:s};r.set(e,a),e.attachInvalidate(s),c.forEach(n=>{E(a,n)}),t()},E=(e,t)=>{let c=l.get(t);if(!c){c={observer:null,callbacks:[]};const s=new MutationObserver(()=>{c.callbacks.forEach(o=>{o()});const n=document.getElementById(t.id);e.host.id===t.getAttribute("for")||n||d(e,t)});c.observer=s,s.observe(t,m),l.set(t,c)}c.callbacks.includes(e.callback)||c.callbacks.push(e.callback)},d=(e,t)=>{var s;const c=l.get(t);c&&(c.callbacks=c.callbacks.filter(a=>a!==e.callback),c.callbacks.length||((s=c.observer)==null||s.disconnect(),l.delete(t))),e.observedElements=e.observedElements.filter(a=>a!==t)},R=e=>{const t=r.get(e);if(!t)return;[...t.observedElements].forEach(s=>{d(t,s)}),e.detachInvalidate(t.invalidationCallback),r.delete(e)};export{A as a,v as b,R as d,g,p as r};
