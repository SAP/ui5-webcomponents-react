import{O as m}from"./Keys-Df3IBHp2.js";import{t as y}from"./getActiveElement-kltGt_DR.js";import{s as b,m as v,I,w as M}from"./withWebComponent-DfVDXLfc.js";import{l as x}from"./event-strict-DgQLNDEV.js";import{i as T,d as K,f as C}from"./index-BwvLAi8p.js";var _;(function(l){l.None="None",l.Single="Single",l.Multiple="Multiple"})(_||(_={}));const a=_;var u=function(l,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,i);else for(var r=l.length-1;r>=0;r--)(o=l[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n};let d=class extends I{constructor(){super(...arguments),this.mode="Multiple",this.selected="",this.identifier="TableSelection"}onTableActivate(e){this._table=e,this._invalidateTableAndRows()}onExitDOM(){this.mode=a.None,this._invalidateTableAndRows(),this._table=void 0}onBeforeRendering(){this._invalidateTableAndRows()}isSelectable(){return this.mode!==a.None}isMultiSelect(){return this.mode===a.Multiple}hasRowSelector(){return this.mode!==a.None}getRowIdentifier(e){return e.rowKey}isSelected(e){if(!this._table||!this.isSelectable())return!1;if(e.isHeaderRow())return this.areAllRowsSelected();const t=this.getRowIdentifier(e);return this.selectedAsArray.includes(t)}hasSelectedRow(){if(!this._table||!this.isSelectable())return!1;const e=this.selectedAsArray;return this._table.rows.some(t=>{const i=this.getRowIdentifier(t);return e.includes(i)})}areAllRowsSelected(){if(!this._table||!this._table.rows.length||this.mode!==a.Multiple)return!1;const e=this.selectedAsArray;return this._table.rows.every(t=>{const i=this.getRowIdentifier(t);return e.includes(i)})}informSelectionChange(e){var t;(t=this._rangeSelection)!=null&&t.isMouse&&this._rangeSelection.shiftPressed||(e.isHeaderRow()?this._informHeaderRowSelectionChange():this._informRowSelectionChange(e))}get selectedAsArray(){return this.selected.split(" ").filter(String)}set selectedAsArray(e){this.selected=e.filter(String).join(" ")}get selectedAsSet(){return new Set(this.selectedAsArray)}set selectedAsSet(e){this.selectedAsArray=[...e]}_selectRow(e,t){const i=this.getRowIdentifier(e);if(this.mode===a.Multiple){const s=this.selectedAsSet;s[t?"add":"delete"](i),this.selectedAsSet=s}else this.selected=t?i:""}_informRowSelectionChange(e){const t=this.isMultiSelect()?!this.isSelected(e):!0;this._selectRow(e,t),this.fireDecoratorEvent("change")}_informHeaderRowSelectionChange(){const e=this.areAllRowsSelected(),t=this.selectedAsSet;this._table.rows.forEach(i=>{const s=this.getRowIdentifier(i);t[e?"delete":"add"](s)}),this.selectedAsSet=t,this.fireDecoratorEvent("change")}_invalidateTableAndRows(){this._table&&(this.isSelectable()?this.isMultiSelect()||(this.selected=this.selectedAsArray.shift()||""):this.selected="",this._table._invalidate++,this._table.headerRow[0]._invalidate++,this._table.rows.forEach(e=>e._invalidate++))}_onkeydown(e){var i;if(!this.isMultiSelect()||!this._table||!e.shiftKey)return;const t=y();if(!(t!=null&&t.hasAttribute("ui5-table-row")||(i=this._rangeSelection)!=null&&i.isMouse||t!=null&&t.hasAttribute("ui5-growing-row"))){this._stopRangeSelection();return}if(!this._rangeSelection)this._startRangeSelection(t);else if(e.key==="ArrowUp"||e.key==="ArrowDown"){const s=m(e)?-1:1;this._handleRangeSelection(t,s)}this._rangeSelection&&(this._rangeSelection.shiftPressed=e.shiftKey)}_onkeyup(e,t){this._table&&((!t.hasAttribute("ui5-table-row")||!this._rangeSelection||!e.shiftKey)&&this._stopRangeSelection(),this._rangeSelection&&(this._rangeSelection.shiftPressed=e.shiftKey))}_onclick(e){var i,s,n;if(!this._table)return;if(T(e)){this._stopRangeSelection();return}if(!K(e)){this._stopRangeSelection();return}const t=C(e.composedPath());if(e.shiftKey&&((i=this._rangeSelection)!=null&&i.isMouse)){const o=this._rangeSelection.rows[0],r=this._table.rows.indexOf(o),h=this._table.rows.indexOf(t);if((n=(s=t.shadowRoot)==null?void 0:s.querySelector("#selection-component"))==null||n.toggleAttribute("checked",!0),r===-1||h===-1||t.rowKey===o.rowKey||t.rowKey===this._rangeSelection.rows[this._rangeSelection.rows.length-1].rowKey)return;const f=h-r;this._handleRangeSelection(t,f)}else t&&this._startRangeSelection(t,!0)}_startRangeSelection(e,t=!1){const i=this.isSelected(e);t&&!i||(this._rangeSelection={selected:i,isUp:null,rows:[e],isMouse:t,shiftPressed:!1})}_handleRangeSelection(e,t){var o,r;if(!this._rangeSelection)return;const i=t>0;(o=this._rangeSelection).isUp??(o.isUp=i);const s=i!==this._rangeSelection.isUp&&!this._rangeSelection.isMouse;let n=s&&this.isSelected(e);if(s)this._reverseRangeSelection();else{const h=this._table.rows.indexOf(e),[f,R]=[h,h-t].sort((S,c)=>S-c);n=((r=this._table)==null?void 0:r.rows.slice(f,R+1).reduce((S,c)=>{var g,w;const p=!((g=this._rangeSelection)!=null&&g.rows.includes(c)),A=this.isSelected(c)!==this._rangeSelection.selected;return p&&((w=this._rangeSelection)==null||w.rows.push(c)),this._selectRow(c,this._rangeSelection.selected),S||A},n))||!1}n&&this.fireDecoratorEvent("change")}_stopRangeSelection(){this._rangeSelection=null}_reverseRangeSelection(){var t,i;const e=(t=this._rangeSelection)==null?void 0:t.rows.pop();e&&this._selectRow(e,!1),((i=this._rangeSelection)==null?void 0:i.rows.length)===1&&(this._rangeSelection.isUp=null)}};u([b()],d.prototype,"mode",void 0);u([b()],d.prototype,"selected",void 0);d=u([v({tag:"ui5-table-selection"}),x("change",{bubbles:!0})],d);d.define();const O=M("ui5-table-selection",["mode","selected"],[],[],["change"]);O.displayName="TableSelection";export{O as T,a};
