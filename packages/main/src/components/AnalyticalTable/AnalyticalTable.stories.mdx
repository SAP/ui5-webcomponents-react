import { DocsHeader } from '@docs/DocsHeader';
import { Footer } from '@docs/Footer';
import dataLarge from '../../../../../.storybook/mockData/Friends500.json';
import dataSmall from '../../../../../.storybook/mockData/Friends500.json';
import dataNameAge from '../../../../../.storybook/mockData/NameAge50.json';
import dataTree from '../../../../../.storybook/mockData/FriendsTree.json';
import dataManualSelect from '../../../../../.storybook/mockData/FriendsManualSelect25.json';
import { Canvas, Meta, Story } from '@storybook/addon-docs';
import { ArgsTableWithNote } from '@docs/ArgsTableWithNote';
import '@ui5/webcomponents-icons/dist/delete.js';
import '@ui5/webcomponents-icons/dist/edit.js';
import '@ui5/webcomponents-icons/dist/settings.js';
import { isChromatic } from '../../../../../.storybook/utils';
import { useCallback, useEffect, useMemo, useReducer, useRef, useState } from 'react';
import {
  AnalyticalTable,
  AnalyticalTableHooks,
  Badge,
  BusyIndicator,
  Button,
  CheckBox,
  FlexBox,
  FlexBoxAlignItems,
  FlexBoxDirection,
  FlexBoxJustifyContent,
  Input,
  InputType,
  Label,
  MessageStrip,
  MultiComboBox,
  MultiComboBoxItem,
  Panel,
  AnalyticalTableScaleWidthMode,
  AnalyticalTableSelectionBehavior,
  AnalyticalTableSelectionMode,
  AnalyticalTableVisibleRowCountMode,
  Text,
  TextAlign,
  ToggleButton
} from '../..';
import { DefaultLoadingComponent } from './defaults/LoadingComponent';
import { DefaultNoDataComponent } from './defaults/NoDataComponent';

<Meta
  title="Data Display / AnalyticalTable"
  component={AnalyticalTable}
  parameters={{
    chromatic: { delay: 1000 }
  }}
  args={{
    data: dataLarge,
    columns: [
      {
        Header: 'Name',
        headerTooltip: 'Full Name', // A more extensive description!
        accessor: 'name' // String-based value accessors!
      },
      {
        Header: 'Age',
        accessor: 'age',
        hAlign: TextAlign.End,
        disableGroupBy: true,
        disableSortBy: false,
        disableFilters: false,
        className: 'superCustomClass'
      },
      {
        Header: 'Friend Name',
        accessor: 'friend.name'
      },
      {
        Header: () => <span>Friend Age</span>,
        accessor: 'friend.age',
        hAlign: TextAlign.End,
        filter: (rows, accessor, filterValue) => {
          if (filterValue === 'all') {
            return rows;
          }
          if (filterValue === 'true') {
            return rows.filter((row) => row.values[accessor] >= 21);
          }
          return rows.filter((row) => row.values[accessor] < 21);
        },
        Filter: ({ column }) => {
          return (
            <select
              onChange={(event) => column.setFilter(event.target.value)}
              style={{ width: '100%' }}
              value={column.filterValue ? column.filterValue : 'all'}
            >
              <option value="all">Show All</option>
              <option value="true">Can Drink</option>
              <option value="false">Can't Drink</option>
            </select>
          );
        }
      },
      {
        id: 'actions',
        Header: 'Actions',
        accessor: '.',
        width: 100,
        disableResizing: true,
        disableGroupBy: true,
        disableFilters: true,
        disableSortBy: true,
        Cell: (instance) => {
          const { cell, row, webComponentsReactProperties } = instance;
          // disable buttons if overlay is active to prevent focus
          const isOverlay = webComponentsReactProperties.showOverlay;
          // console.log('This is your row data', row.original);
          return (
            <FlexBox>
              <Button icon="edit" disabled={isOverlay} />
              <Button icon="delete" disabled={isOverlay} />
            </FlexBox>
          );
        }
      }
    ],
    header: 'Table Title',
    sortable: true,
    filterable: true,
    visibleRows: 15,
    minRows: 5,
    groupable: true,
    groupBy: [],
    selectedRowIds: { 3: true },
    withRowHighlight: true,
    infiniteScroll: true,
    infiniteScrollThreshold: 20,
    subRowsKey: 'subRows',
    isTreeTable: false,
    NoDataComponent: DefaultNoDataComponent,
    LoadingComponent: DefaultLoadingComponent,
    scaleWidthMode: AnalyticalTableScaleWidthMode.Default,
    selectionMode: AnalyticalTableSelectionMode.SingleSelect,
    selectionBehavior: AnalyticalTableSelectionBehavior.Row,
    overscanCountHorizontal: 5,
    visibleRowCountMode: AnalyticalTableVisibleRowCountMode.Fixed
  }}
  argTypes={{
    data: { control: { disable: true } },
    columns: {
      control: { disable: true },
      description:
        'Defines the columns array where you can define the configuration for each column.<br />Please refer to the [AnalyticalTableColumnDefinition interface](#column-properties) for a full list of options.'
    },
    reactTableOptions: { control: { disable: true } },
    tableHooks: { control: { disable: true } },
    NoDataComponent: { control: { disable: true } },
    LoadingComponent: { control: { disable: true } },
    extension: { control: { disable: true } },
    tableInstance: { control: { disable: true } },
    portalContainer: { control: { disable: true } }
  }}
/>

<DocsHeader />

<br />

## Example

<Canvas withSource="none">
  <Story name="Default">{(args) => <AnalyticalTable {...args} />}</Story>
</Canvas>

### Code

<details>

<summary>Show Code</summary>

```jsx
<AnalyticalTable
  columns={[
    {
      Header: 'Name',
      accessor: 'name',
      headerTooltip: 'Full Name'
    },
    {
      Header: 'Age',
      accessor: 'age',
      className: 'superCustomClass',
      disableFilters: false,
      disableGroupBy: true,
      disableSortBy: false,
      hAlign: 'End'
    },
    {
      Header: 'Friend Name',
      accessor: 'friend.name'
    },
    {
      accessor: 'friend.age',
      hAlign: 'End',
      Header: () => <span>Friend Age</span>,
      filter: (rows, accessor, filterValue) => {
        if (filterValue === 'all') {
          return rows;
        }
        if (filterValue === 'true') {
          return rows.filter((row) => row.values[accessor] >= 21);
        }
        return rows.filter((row) => row.values[accessor] < 21);
      },
      Filter: ({ column }) => {
        return (
          <select
            onChange={(event) => column.setFilter(event.target.value)}
            style={{ width: '100%' }}
            value={column.filterValue ? column.filterValue : 'all'}
          >
            <option value="all">Show All</option>
            <option value="true">Can Drink</option>
            <option value="false">Can't Drink</option>
          </select>
        );
      }
    },
    {
      Cell: (instance) => {
        const { cell, row, webComponentsReactProperties } = instance;
        // disable buttons if overlay is active to prevent focus
        const isOverlay = webComponentsReactProperties.showOverlay;
        // console.log('This is your row data', row.original);
        return (
          <FlexBox>
            <Button icon="edit" disabled={isOverlay} />
            <Button icon="delete" disabled={isOverlay} />
          </FlexBox>
        );
      },
      Header: 'Actions',
      accessor: '.',
      disableFilters: true,
      disableGroupBy: true,
      disableResizing: true,
      disableSortBy: true,
      id: 'actions',
      width: 100
    }
  ]}
  data={[
    {
      age: 80,
      friend: {
        age: 68,
        name: 'Carver Vance'
      },
      name: 'Allen Best',
      status: 'Success'
    },
    {
      age: 31,
      friend: {
        age: 70,
        name: 'Strickland Gallegos'
      },
      name: 'Combs Fleming',
      status: 'None'
    }
    // shortened for readability
  ]}
  filterable
  groupBy={[]}
  groupable
  header="Table Title"
  infiniteScroll
  onColumnsReorder={() => {}}
  onGroup={() => {}}
  onLoadMore={() => {}}
  onRowClick={() => {}}
  onRowExpandChange={() => {}}
  onRowSelect={() => {}}
  onSort={() => {}}
  onTableScroll={() => {}}
  rowHeight={44}
  selectedRowIds={{
    3: true
  }}
  selectionMode="SingleSelect"
  withRowHighlight
/>
```

</details>

## Properties

<ArgsTableWithNote story="Default" />

## Column Properties

**Required Attributes**

| Attribute  | Type                                              | Description                               |
| ---------- | ------------------------------------------------- | ----------------------------------------- |
| `accessor` | `string OR ((row: any, rowIndex: number) => any)` |                                           |
| `id`       | `string`                                          | Only required if `accessor` is a function |

**Optional Properties**

| Attribute             | Type                                                                     | Description                                                                                                                                                                                                                                                                                                                                                                                                     |
| --------------------- | ------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Header`              | `string OR ComponentType`                                                | Can either be `string` or a React component that will be rendered as column header                                                                                                                                                                                                                                                                                                                              |
| `headerTooltip`       | `string`                                                                 | Tooltip for the column header. If not set, the display text will be the same as the Header if it is a `string`                                                                                                                                                                                                                                                                                                  |
| `Cell`                | `ComponentType`                                                          | Custom cell renderer. If set, the table will call that component for every cell and pass all required information as props, e.g. the cell value as `props.cell.value`                                                                                                                                                                                                                                           |
| `width`               | `number`                                                                 | Cell width, if not set the table will distribute all columns without a width evenly                                                                                                                                                                                                                                                                                                                             |
| `minWidth`            | `number`                                                                 | min width of the column, e.g. used for resizing                                                                                                                                                                                                                                                                                                                                                                 |
| `maxWidth`            | `number`                                                                 | max with of the column, e.g. used for resizing                                                                                                                                                                                                                                                                                                                                                                  |
| `Filter`              | `ComponentType`                                                          | Filter Component to be rendered in the Header                                                                                                                                                                                                                                                                                                                                                                   |
| `disableFilters`      | `boolean`                                                                | Disable filters for this column                                                                                                                                                                                                                                                                                                                                                                                 |
| `disableGlobalFilter` | `boolean`                                                                | Disable global filtering for this column                                                                                                                                                                                                                                                                                                                                                                        |
| `defaultCanFilter`    | `boolean`                                                                | If set to true, this column will be filterable, regardless if it has a valid `accessor`                                                                                                                                                                                                                                                                                                                         |
| `filter`              | `string OR Function`                                                     | Either a string or a filter function.<br />Supported String Values: <ul><li>`text`</li><li>`exactText`</li><li>`exactTextCase`</li><li>`equals`</li></ul>                                                                                                                                                                                                                                                       |
| `Aggregated`          | `ComponentType`                                                          | Component to render for aggregated cells                                                                                                                                                                                                                                                                                                                                                                        |
| `aggregate`           | `string OR ((leafValues, aggregatedValues) => any)`                      | Aggregation function or string.<br />Supported String Values: <ul><li>`sum`</li><li>`min`</li><li>`max`</li><li>`minMax`</li><li>`average`</li><li>`median`</li><li>`unique`</li><li>`uniqueCount`</li><li>`count`</li></ul>                                                                                                                                                                                    |
| `aggregateValue`      | `string OR ((values, row, column) => any)`                               | When attempting to group/aggregate non primitive cell values (eg. arrays of items) you will likely need to resolve a stable primitive value like a number or string to use in normal row aggregations. This property can be used to aggregate or simply access the value to be used in aggregations eg. count-ing the unique number of items in a cell's array value before sum-ing that count across the table |
| `disableGroupBy`      | `boolean`                                                                | Disable groupBy for this column                                                                                                                                                                                                                                                                                                                                                                                 |
| `defaultCanSort`      | `boolean`                                                                | If set to true, this column will be sortable, regardless if it has a valid `accessor`                                                                                                                                                                                                                                                                                                                           |
| `disableSortBy`       | `boolean`                                                                | Disable sorting for this column                                                                                                                                                                                                                                                                                                                                                                                 |
| `sortDescFirst`       | `boolean`                                                                | If set to `true`, the first sort direction for this column will be descending instead of ascending.                                                                                                                                                                                                                                                                                                             |
| `sortInverted`        | `boolean`                                                                | If set to `true`, the underlying sorting direction will be inverted, but the UI will not.                                                                                                                                                                                                                                                                                                                       |
| `sortType`            | `string OR ((rowA, rowB, columnId: string, descending: boolean) => any)` | String or custom sort function.<br />Supported String Values: <ul><li>`basic`</li><li>`datetime`</li><li>`alphanumeric`</li></ul>                                                                                                                                                                                                                                                                               |
| `disableResizing`     | `boolean`                                                                | Disable resizing for this column                                                                                                                                                                                                                                                                                                                                                                                |
| `hAlign`              | `TextAlign`                                                              | Horizontal align of the cell                                                                                                                                                                                                                                                                                                                                                                                    |
| `vAlign`              | `VerticalAlign`                                                          | Vertical align of the cell                                                                                                                                                                                                                                                                                                                                                                                      |
| `responsivePopIn`     | `boolean`                                                                | Enables the pop-in behavior of the column. When the `responsiveMinWidth` is smaller then the width of the table, the content of each cell will move to the first cell in the row, improving usability on small or mobile devices.                                                                                                                                                                               |
| `responsiveMinWidth`  | `number`                                                                 | Defines how the table should react when its width falls below the `responsiveMinWidth`. <ul><li>If `responsivePopIn` is `true` the content of this column will be moved to the first column.</li><li>If `responsivePopIn` is not set or `false` the column will be hidden.</li></ul>                                                                                                                            |
| `PopInHeader`         | `string OR ComponentType`                                                | Custom pop-in header renderer. If set, the table will call that component for every column that is "popped-in" and pass the table instance as prop.                                                                                                                                                                                                                                                             |
| `disableDragAndDrop`  | `boolean`                                                                | Defines if the column is reorderable by dragging and dropping columns.                                                                                                                                                                                                                                                                                                                                          |
| `canReorder`          | `boolean`                                                                | **deprecated** Defines if the column is reorderable by dragging and dropping columns. Please use `disableDragAndDrop` instead. Defaults to: `true`.                                                                                                                                                                                                                                                             |

<br />

## Plugin Hooks

Plugin hooks are adding features to the `AnalyticalTable` that are meant for special use-cases and are therefore not enabled by default.
To add a plugin hook you first need to `import` the corresponding hook and then add it to the `tableHooks` array.

```js
import { AnalyticalTableHooks } from '@ui5/webcomponents-react';
```

```jsx
<AnalyticalTable
  data={data}
  columns={columns}
  tableHooks={[AnalyticalTableHooks.useRowDisableSelection('myAccessorToDisableRowSelection')]}
/>
```

### Disable the selection of single rows

With the `useRowDisableSelection` it's possible to disable the selection of specific rows. It can receive two types of parameters:

- `string`: Defines the key in the dataset for disabling rows. If the value of the key is `true`, then the row will not be selectable.
- `Function(row) => boolean`: Programmatically disable rows for selection. The function receives the current row as parameter.

_ES6 Import: `import { AnalyticalTableHooks } from '@ui5/webcomponents-react';`_

**Note:** The "Select All" checkbox is not available with this hook.

<Canvas withSource="none">
  <Story
    name="Plugin: useRowDisableSelection"
    args={{
      data: dataSmall.map((item) => ({ ...item, disableSelection: Math.random() < 0.5 })),
      selectionMode: AnalyticalTableSelectionMode.MultiSelect
    }}
  >
    {(args) => {
      const disableRowFunc = (row) => row.original.age < 40;
      const [isFunc, setIsFunc] = useState(true);
      const [collapsed, setCollapsed] = useReducer((coll) => !coll, !isChromatic);
      return (
        <Panel collapsed={collapsed} onToggle={setCollapsed} headerText="Show useRowDisableSelection example">
          {collapsed ? (
            <BusyIndicator active style={{ width: '100%' }}>
              <span style={{ height: '580px' }} />
            </BusyIndicator>
          ) : (
            <>
              <ToggleButton
                onClick={() => {
                  setIsFunc(true);
                }}
                pressed={isFunc}
              >
                with function parameter
              </ToggleButton>
              <ToggleButton
                onClick={() => {
                  setIsFunc(false);
                }}
                pressed={!isFunc}
              >
                with string parameter
              </ToggleButton>
              {isFunc ? (
                <AnalyticalTable
                  data={args.data}
                  columns={args.columns}
                  selectionMode={args.selectionMode}
                  selectedRowIds={[]}
                  tableHooks={[AnalyticalTableHooks.useRowDisableSelection(disableRowFunc)]}
                  visibleRows={10}
                  header="All under 40 are not selectable"
                />
              ) : (
                <AnalyticalTable
                  data={args.data}
                  columns={args.columns}
                  selectionMode={args.selectionMode}
                  selectionBehavior={args.selectionBehavior}
                  tableHooks={[AnalyticalTableHooks.useRowDisableSelection('disableSelection')]}
                  visibleRows={10}
                  header={`All with "disableSelection: true" are not selectable`}
                />
              )}
            </>
          )}
        </Panel>
      );
    }}
  </Story>
</Canvas>

#### Code

<details>

<summary>Show Code</summary>

```jsx
const WithFunctionParameter = () => {
  const disableRowFunc = (row) => row.original.age < 40;
  return (
    <AnalyticalTable
      data={data}
      columns={columns}
      selectionMode={AnalyticalTableSelectionMode.MultiSelect}
      tableHooks={[AnalyticalTableHooks.useRowDisableSelection(disableRowFunc)]}
    />
  );
};

const WithStringParameter = () => {
const data = [
    {
        "name": "Peter Franco",
        "age": 22,
         ...
        "disableSelection": Math.random() < 0.5
    },
    ...
];
  return (
    <AnalyticalTable
      data={data}
      columns={columns}
      selectionMode={AnalyticalTableSelectionMode.MultiSelect}
      tableHooks={[AnalyticalTableHooks.useRowDisableSelection('disableSelection')]}
    />
  );
};
```

</details>

### MultiSelect with indeterminate state

The `useIndeterminateRowSelection` plugin hook allows marking parent rows as indeterminate when a child row is selected.
When using this hook, it is recommended to also select all sub-rows when selecting a row. (`reactTableOptions={{ selectSubRows: true }}`)

<MessageStrip hideCloseButton>
  The indeterminate state has a higher priority than the selected state. Therefore, a row can be selected and
  indeterminate at the same time. This can for example happen, if `selectSubRows: true` is set and a row with sub-rows
  is selected and then a sub-row is unselected.
</MessageStrip>

_ES6 Import: `import { AnalyticalTableHooks } from '@ui5/webcomponents-react';`_

<Canvas withSource="none">
  <Story name="Plugin: useIndeterminateRowSelection" args={{ data: dataTree }}>
    {(args) => {
      const [collapsed, setCollapsed] = useReducer((coll) => !coll, !isChromatic);
      const [selectSubRows, setSelectSubRows] = useReducer((prev) => !prev, true);
      return (
        <Panel collapsed={collapsed} onToggle={setCollapsed} headerText="Show useIndeterminateRowSelection example">
          {collapsed ? (
            <BusyIndicator active style={{ width: '100%' }}>
              <span style={{ height: '800px' }} />
            </BusyIndicator>
          ) : (
            <>
              <ToggleButton onClick={setSelectSubRows} pressed={selectSubRows}>{`${
                selectSubRows ? "Don't " : ''
              }Select Sub-Rows`}</ToggleButton>
              <AnalyticalTable
                selectionMode={AnalyticalTableSelectionMode.MultiSelect}
                data={args.data}
                columns={args.columns}
                isTreeTable
                tableHooks={[AnalyticalTableHooks.useIndeterminateRowSelection()]}
                reactTableOptions={{ selectSubRows: selectSubRows }}
              />
            </>
          )}
        </Panel>
      );
    }}
  </Story>
</Canvas>

```jsx
<AnalyticalTable
  selectionMode={AnalyticalTableSelectionMode.MultiSelect}
  data={data}
  columns={columns}
  isTreeTable
  tableHooks={[AnalyticalTableHooks.useIndeterminateRowSelection()]}
  reactTableOptions={{ selectSubRows: true }}
/>
```

#### Optional function parameter

The plugin hook allows passing a callback as parameter with the following structure:

```js
({indeterminateRowsById, tableInstance}) => void;
```

The callback is fired, every time the internal `indeterminateRows` state is changed.
The event parameter is an object, with all indeterminate rows by id (e.g. `{"0.1":true}`) and the table instance.

### Manual control of selected lines

The `useManualRowSelect` plugin hook allows controlling the selected rows manually. It accepts a parameter (`manualRowSelectedKey`) which defaults to `isSelected`.
If this key is found on the original data row, and it is `true`, this row will be manually selected.

<Canvas withSource="none">
  <Story name="Plugin: useManualRowSelect" args={{ data: dataManualSelect }}>
    {(args) => {
      const [collapsed, setCollapsed] = useReducer((coll) => !coll, !isChromatic);
      const [collapsedCode, setCollapsedCode] = useReducer((coll) => !coll, true);
      const [data, toggleFirstRowSelected] = useReducer((prev) => {
        const [, ...updatedData] = prev;
        if (prev[0].isSelected) {
          return [{ ...prev[0], isSelected: false }, ...updatedData];
        } else {
          return [{ ...prev[0], isSelected: true }, ...updatedData];
        }
      }, args.data);
      return (
        <Panel collapsed={collapsed} onToggle={setCollapsed} headerText="Show useManualRowSelect example">
          {collapsed ? (
            <BusyIndicator active style={{ width: '100%' }}>
              <span style={{ height: '800px' }} />
            </BusyIndicator>
          ) : (
            <>
              <Button onClick={toggleFirstRowSelected}>Toggle `isSelected` of 1st row</Button>
              <br />
              <Label>Clicking this button will refresh the data array passed to the `data` prop.</Label>
              <br />
              <br />
              <AnalyticalTable
                selectionMode={AnalyticalTableSelectionMode.MultiSelect}
                data={data}
                columns={args.columns}
                tableHooks={[AnalyticalTableHooks.useManualRowSelect('isSelected')]}
              />
              <Button onClick={setCollapsedCode}>Show first entries in data array</Button>
              {!collapsedCode && (
                <FlexBox direction="Column">
                  <span>{JSON.stringify(data[0], null, 2)}</span>
                  <span>{JSON.stringify(data[1], null, 2)}</span>
                  <span>{JSON.stringify(data[2], null, 2)}</span>
                  <span>{JSON.stringify(data[3], null, 2)}</span>
                  <span>{JSON.stringify(data[4], null, 2)}</span>
                  <span>...</span>
                </FlexBox>
              )}
            </>
          )}
        </Panel>
      );
    }}
  </Story>
</Canvas>

```jsx
<AnalyticalTable
  selectionMode={AnalyticalTableSelectionMode.MultiSelect}
  data={data}
  columns={columns}
  // you could also omit the `'isSelected'`, as this is the default value
  tableHooks={[AnalyticalTableHooks.useManualRowSelect('isSelected')]}
/>
```

### Callback for column resize

The `useOnColumnResize` plugin hook allows firing a callback when a columns size has changed by dragging the "Resizer".
The first parameter is the callback itself (`e: { columnWidth: number; header: Record<string, any> }) => void;`), the second one are the optional `options` for controlling how often the callback should fire.

`options`:

- `liveUpdate`: If `liveUpdate` is `true`, the resize function will fire every time the width has changed depending on the `options.wait` delay.
- `wait`: The number of milliseconds for which the calls are to be delayed. **Defaults to `100`**. (Only has an effect if `liveUpdate` is `true`)

_ES6 Import: `import { AnalyticalTableHooks } from '@ui5/webcomponents-react';`_

<Canvas withSource="none">
  <Story name="Plugin: useOnColumnResize">
    {(args) => {
      const [collapsed, setCollapsed] = useReducer((coll) => !coll, !isChromatic);
      const [useColResizeEvent, setUseColResizeEvent] = useState({});
      const [liveUpdate, setLiveUpdate] = useState(false);
      const [wait, setWait] = useState(100);
      const handleLiveUpdateChange = (e) => {
        setLiveUpdate(e.target.checked);
      };
      const handleWaitChange = (e) => {
        setWait(parseInt(e.target.value));
      };
      const handleColWidthUpdate = (e) => {
        setUseColResizeEvent(e);
      };
      return (
        <Panel collapsed={collapsed} onToggle={setCollapsed} headerText="Show useOnColumnResize example">
          {collapsed ? (
            <BusyIndicator active style={{ width: '100%' }}>
              <span style={{ height: '800px' }} />
            </BusyIndicator>
          ) : (
            <>
              <AnalyticalTable
                extension={
                  <>
                    <FlexBox alignItems={FlexBoxAlignItems.Center}>
                      <Label>liveUpdate: </Label>
                      <CheckBox onChange={handleLiveUpdateChange} checked={liveUpdate} />
                    </FlexBox>
                    <FlexBox alignItems={FlexBoxAlignItems.Center}>
                      <Label>wait: </Label>
                      <Input onInput={handleWaitChange} type={InputType.Number} value={`${wait}`} />
                    </FlexBox>
                    <br />
                  </>
                }
                data={args.data}
                columns={args.columns}
                tableHooks={[AnalyticalTableHooks.useOnColumnResize(handleColWidthUpdate, { liveUpdate, wait })]}
              />
              {!!Object.keys(useColResizeEvent).length && (
                <FlexBox direction={FlexBoxDirection.Column}>
                  <br />
                  <Text>Last fired callback of changed column:</Text>
                  <br />
                  <FlexBox>
                    <Label>Column:</Label>
                    <Text>{useColResizeEvent.header.id}</Text>
                  </FlexBox>
                  <FlexBox>
                    <Label>Width:</Label>
                    <Text>{useColResizeEvent.columnWidth}</Text>
                  </FlexBox>
                </FlexBox>
              )}
            </>
          )}
        </Panel>
      );
    }}
  </Story>
</Canvas>

#### Code

```jsx
const TableComponent = (props) => {
  const handleColumResize = (e) => {
    console.log(e.columnWidth, e.header);
  };
  return (
    <AnalyticalTable
      data={props.data}
      columns={props.columns}
      tableHooks={[
        AnalyticalTableHooks.useOnColumnResize(handleColumResize, {
          liveUpdate: false,
          wait: 100
        })
      ]}
    />
  );
};
```

<br />

## Recipes

### How to add your own plugin hooks

The `AnalyticalTable` internally uses all plugin hooks of the [react-table](https://github.com/tannerlinsley/react-table) except for `usePagination` and hooks that change the layout.
If you pass a `react-table` hook to the `tableHooks` prop of the `AnalyticalTable` you will most likely experience some side effects or even break the table completely. We therefore strongly recommend to just not do it ;).
If you encounter a functionality that should be available with `react-table` hooks, but isn't in the `AnalyticalTable` please open an issue in github or write us in Slack.

<MessageStrip type="Warning" hideCloseButton>
  Plugin hooks can manipulate the internal table instance. Please use with caution!
</MessageStrip>

For adding custom plugin hooks you can use the following code snippet.

```jsx
export const TableWithCustomHook = (props) => {
  const { data, columns } = props;
  const customHook = (hooks) => {
    hooks.useInstance.push((instance) => {
      console.log(instance);
    });
  };
  return <AnalyticalTable data={data} columns={columns} tableHooks={[customHook]} />;
};
```

With the `customHook` callback you can plugin in all available hooks. Please note that some hooks need a return value (e.g. `columns`) which is then always the first parameter of the function, and others are not allowed to return a value (e.g. `useTable`).
For further details please refer to the [`react-table` documentation](https://react-table-v7.tanstack.com/docs/api/overview).

### How to select rows containing active elements

We've restricted the propagation of `click` events of UI5 Web Components elements such as `Button`, `Link`, `Switch`, etc.
In case you still want to select the row when clicking the respective element, you can "mark" the event to allow such behavior. <br />
Example: `<Link onClick={(e) => {e.markerAllowTableRowSelection = true;}>My Link Text</Link>`

For other elements or components, we recommend disabling event propagation by setting `event.stopPropagation()` on the respective event. Per default, propagation is not prevented!

### How to stop the table state from automatically resetting when the data changes

By default, the `AnalyticalTable` will reset the sorters, filters, grouping, selected rows, etc. when the table data changes. It will also reset all manually resized columns if the container width changes.
In case you want to keep the current state of the Table, you can disable this behavior by using the `reactTableOptions` prop or for column resize the `retainColumnWidth` prop.

```jsx
const [data, setData] = React.useState([])
const skipPageResetRef = React.useRef(false)

const updateData = newData => {
  // When data gets updated with this function, set a flag
  // to disable all of the auto resetting
  skipPageResetRef.current = true

  setData(newData)
}

React.useEffect(() => {
  // After the table has updated, always remove the flag
  skipPageResetRef.current = false
})
<AnalyticalTable
  columns={columns}
  data={data}
  // disable auto reset of columns width if a column has been manually resized
  retainColumnWidth
  // react-table options
  reactTableOptions={{
    // ... any other options you want to set
    autoResetHiddenColumns: !skipPageResetRef.current,
    autoResetPage: !skipPageResetRef.current,
    autoResetExpanded: !skipPageResetRef.current,
    autoResetGroupBy: !skipPageResetRef.current,
    autoResetSelectedRows: !skipPageResetRef.current,
    autoResetSortBy: !skipPageResetRef.current,
    autoResetFilters: !skipPageResetRef.current,
    autoResetRowState: !skipPageResetRef.current,
    autoResetResize: !skipPageResetRef.current
  }}
/>
```

For more details on this behavior you can double check the [react-table docs](https://react-table-v7.tanstack.com/docs/faq#how-do-i-stop-my-table-state-from-automatically-resetting-when-my-data-changes).

### How to scroll to a specific row/offset?

The DOM instance of the `AnalyticalTable` exposes methods for scrolling to a specific index or offset. (You can access the DOM element e.g. by creating a Ref `ref={analyticalTableRef}`)

- `scrollTo: (offset: number, align?: 'start' | 'center' | 'end' | 'auto') => void`
- `scrollToItem: (index: number, align?: 'start' | 'center' | 'end' | 'auto') => void`
- `horizontalScrollTo: (offset: number, align?: 'start' | 'center' | 'end' | 'auto') => void`
- `horizontalScrollToItem: (index: number, align?: 'start' | 'center' | 'end' | 'auto') => void`

`offset` is measured in `px` and `index` in rows. `align` places the item/offset at the corresponding position of the visible scroll area (`'auto'` brings the item/offset into the visible scroll area either at the start or end, depending on which is closer). The default value for `align` is `'start'`.

### How to manually sort, filter or group the table?

For e.g. server side sorting, filtering or grouping, the default behavior of the table can be prevented. When setting the following `reactTableOption` the event is still fired and the indicator still set, but the internal data stays the same.
If you wish to implement your own data manipulation outside the table you can use:

```jsx
<AnalyticalTable
  ...
  reactTableOptions={{
    manualSortBy: true,
    manualFilters: true,
    manualGroupBy: true
  }}
/>
```

For more information please take a look at the [React Table v7 docs](https://react-table-v7.tanstack.com/docs/api/overview).

### How to distinguish between `onRowClick` and `onRowSelect` on selection-cell click?

When a selectable cell of the table is clicked, both `onRowClick` and `onRowSelect` are fired. Sometimes, but especially when the selection behavior is set to `RowSelector`, you don't want `onRowClick` to execute the logic you defined in your handler when clicking the selection-cell.
To achieve this, you can check the `target` inside the `onRowClick` handler for the `data-selection-cell` attribute contained in the [dataset](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/dataset) and only execute your logic if this property is falsy.

```js
// both events are fired if the clicked cell is selectable
const onRowClick = (e) => {
  if (!e.target.dataset.selectionCell) {
    // only do something if other cells than the selection cell are clicked
  }
};
const onRowSelect = (e) => {
  // do something on row select
};
```

### How to hide columns?

[React Table v7](https://react-table-v7.tanstack.com/docs/api/useTable) exposes an API on the table instance to hide columns. You can leverage it for example by attaching a React Ref to the `tableInstance` prop.
Please note that the internal react-table is resetting its hidden state after hiding the column, which is most probably a bug. To prevent this you can set the `autoResetHiddenColumns` table option to `false`. (See [here](https://sap.github.io/ui5-webcomponents-react/?path=/docs/data-display-analyticaltable--default-story#how-to-stop-the-table-state-from-automatically-resetting-when-the-data-changes))

```jsx
  <Button
    onClick={() => {
      tableInstanceRef.current.toggleHideColumn("age");
    }}
  >
    Toggle Age Col
  </Button>
  <AnalyticalTable
    columns={COLUMNS}
    data={DATA}
    tableInstance={tableInstanceRef}
    reactTableOptions={{
      autoResetHiddenColumns: false
    }}
  />
```

# More Examples

<br />

## Tree Table

<Canvas withSource="none">
  <Story name="Tree Table" args={{ data: dataTree, isTreeTable: true }}>
    {(args) => {
      const [collapsed, setCollapsed] = useReducer((coll) => !coll, !isChromatic);
      return (
        <Panel collapsed={collapsed} onToggle={setCollapsed} headerText="Show Tree Table">
          {collapsed ? (
            <BusyIndicator active style={{ width: '100%' }}>
              <span style={{ height: '800px' }} />
            </BusyIndicator>
          ) : (
            <AnalyticalTable {...args} />
          )}
        </Panel>
      );
    }}
  </Story>
</Canvas>

The `data` structure of the tree table is as follows:

```js
const data = {
    name: "Greg Miller",
    age: 35,
    friend: {
        name: "Rose Franco",
        age: 32,
    },
    status: "None",
    subRows: [
        {
            name: "Rick DeAngelo",
            age: 25,
            friend: {
                name: "Susanne Franco",
                age: 37,
            },
            status: "None",
            subRows: [...],
        },
    ],
    ...
};
```

In this example the default key for sub row detection is used (`subRows`), you can use any key you like by setting the `subRowsKey` prop.

<br />

## Infinite Scrolling

The table initially contains 50 rows, when the last 10 rows are reached the table will load more data.

<Canvas withSource="none">
  <Story name="Infinite Scrolling">
    {(args) => {
      const [data, setData] = useState(args.data.slice(0, 50));
      const [loading, setLoading] = useState(false);
      const offset = useRef(50);
      const onLoadMore = () => {
        setLoading(true);
      };
      useEffect(() => {
        if (loading) {
          setTimeout(() => {
            setData((prev) => [...prev, ...args.data.slice(offset.current, offset.current + 50)]);
            setLoading(false);
            offset.current += 50;
          }, 2000);
        }
      }, [loading, args.data, offset.current]);
      const [collapsed, setCollapsed] = useReducer((coll) => !coll, !isChromatic);
      return (
        <Panel collapsed={collapsed} onToggle={setCollapsed} headerText="Show infinite scroll table">
          {collapsed ? (
            <BusyIndicator active style={{ width: '100%' }}>
              <span style={{ height: '750px' }} />
            </BusyIndicator>
          ) : (
            <AnalyticalTable
              data={data}
              columns={args.columns}
              infiniteScroll={true}
              infiniteScrollThreshold={10}
              header="Scroll to load more data"
              onLoadMore={onLoadMore}
              loading={loading}
            />
          )}
        </Panel>
      );
    }}
  </Story>
</Canvas>

### Code

<details>

<summary>Show Code</summary>

```jsx
const InfiniteScrollTable = (props) => {
  const [data, setData] = useState(props.data.slice(0, 50));
  const [loading, setLoading] = useState(false);
  const offset = useRef(50);
  const onLoadMore = () => {
    setLoading(true);
  };
  useEffect(() => {
    if (loading) {
      setTimeout(() => {
        setData((prev) => [...prev, ...props.data.slice(offset.current, offset.current + 50)]);
        setLoading(false);
        offset.current += 50;
      }, 2000);
    }
  }, [loading, props.data, offset.current]);
  return (
    <AnalyticalTable
      data={data}
      columns={props.columns}
      infiniteScroll={true}
      infiniteScrollThreshold={10}
      header="Scroll to load more data"
      onLoadMore={onLoadMore}
      loading={loading}
    />
  );
};
```

</details>

## AnalyticalTable with subcomponents

Adding custom subcomponents below table rows can be achieved by setting the `renderRowSubComponent` prop.
The prop expects a function with an optional parameter containing the `row` instance, there you can control which row should display subcomponents. If you want to display the subcomponent at the bottom of the row without an expandable container, you can set the `alwaysShowSubComponent` prop to `true`.

**Note:** When `renderRowSubComponent` is set, `grouping` is disabled.

<ArgsTableWithNote story="with subcomponents" hideHTMLPropsNote />

<Canvas withSource="none">
  <Story
    name="with subcomponents"
    args={{ data: dataSmall }}
    argTypes={{
      columns: { table: { disable: true } },
      data: { table: { disable: true } },
      header: { table: { disable: true } },
      headerRowHeight: { table: { disable: true } },
      extension: { table: { disable: true } },
      minRows: { table: { disable: true } },
      visibleRowCountMode: { table: { disable: true } },
      visibleRows: { table: { disable: true } },
      loading: { table: { disable: true } },
      noDataText: { table: { disable: true } },
      rowHeight: { table: { disable: true } },
      alternateRowColor: { table: { disable: true } },
      withRowHighlight: { table: { disable: true } },
      highlightField: { table: { disable: true } },
      filterable: { table: { disable: true } },
      sortable: { table: { disable: true } },
      groupable: { table: { disable: true } },
      groupBy: { table: { disable: true } },
      selectionBehavior: { table: { disable: true } },
      selectionMode: { table: { disable: true } },
      scaleWidthMode: { table: { disable: true } },
      columnOrder: { table: { disable: true } },
      infiniteScroll: { table: { disable: true } },
      infiniteScrollThreshold: { table: { disable: true } },
      onSort: { table: { disable: true } },
      onGroup: { table: { disable: true } },
      onRowSelect: { table: { disable: true } },
      onRowExpandChange: { table: { disable: true } },
      onColumnsReorder: { table: { disable: true } },
      onLoadMore: { table: { disable: true } },
      reactTableOptions: { table: { disable: true } },
      tableHooks: { table: { disable: true } },
      subRowsKey: { table: { disable: true } },
      selectedRowIds: { table: { disable: true } },
      isTreeTable: { table: { disable: true } },
      overscanCountHorizontal: { table: { disable: true } },
      overscanCount: { table: { disable: true } },
      NoDataComponent: { table: { disable: true } },
      LoadingComponent: { table: { disable: true } },
      style: { table: { disable: true } },
      className: { table: { disable: true } },
      tooltip: { table: { disable: true } },
      onRowClick: { table: { disable: true } },
      withNavigationHighlight: { table: { disable: true } },
      markNavigatedRow: { table: { disable: true } },
      globalFilterValue: { table: { disable: true } },
      tableInstance: { table: { disable: true } },
      adjustTableHeightOnPopIn: { table: { disable: true } },
      onTableScroll: { table: { disable: true } },
      portalContainer: { table: { disable: true } },
      showOverlay: { table: { disable: true } },
      scaleXFactor: { table: { disable: true } },
      retainColumnWidth: { table: { disable: true } }
    }}
  >
    {(args) => {
      const renderRowSubComponent = (row) => {
        if (row.id === '0') {
          return (
            <FlexBox
              style={{ backgroundColor: 'lightblue', height: '300px' }}
              justifyContent={FlexBoxJustifyContent.Center}
              alignItems={FlexBoxAlignItems.Center}
              direction={FlexBoxDirection.Column}
            >
              <Badge>height: 300px</Badge>
              <Text>This subcomponent will only be displayed below the first row.</Text>
            </FlexBox>
          );
        }
        if (row.id === '1') {
          return (
            <FlexBox
              style={{ backgroundColor: 'lightyellow', height: '100px' }}
              justifyContent={FlexBoxJustifyContent.Center}
              alignItems={FlexBoxAlignItems.Center}
              direction={FlexBoxDirection.Column}
            >
              <Badge>height: 100px</Badge>
              <Text>This subcomponent will only be displayed below the second row.</Text>
            </FlexBox>
          );
        }
        if (row.id === '2') {
          return null;
        }
        return (
          <FlexBox
            style={{ backgroundColor: 'lightgrey', height: '50px' }}
            justifyContent={FlexBoxJustifyContent.Center}
            alignItems={FlexBoxAlignItems.Center}
            direction={FlexBoxDirection.Column}
          >
            <Badge>height: 50px</Badge>
            <Text>This subcomponent will be displayed below all rows except the first, second and third.</Text>
          </FlexBox>
        );
      };
      return (
        <AnalyticalTable
          data={args.data}
          columns={args.columns}
          renderRowSubComponent={renderRowSubComponent}
          alwaysShowSubComponent={args.alwaysShowSubComponent}
        />
      );
    }}
  </Story>
</Canvas>

### Code

<details>

<summary>Show Code</summary>

```jsx
const TableWithSubcomponents = (props) => {
  const renderRowSubComponent = (row) => {
    if (row.id === '0') {
      return (
        <FlexBox
          style={{ backgroundColor: 'lightblue', height: '300px' }}
          justifyContent={FlexBoxJustifyContent.Center}
          alignItems={FlexBoxAlignItems.Center}
          direction={FlexBoxDirection.Column}
        >
          <Badge>height: 300px</Badge>
          <Text>This subcomponent will only be displayed below the first row.</Text>
        </FlexBox>
      );
    }
    if (row.id === '1') {
      return (
        <FlexBox
          style={{ backgroundColor: 'lightyellow', height: '100px' }}
          justifyContent={FlexBoxJustifyContent.Center}
          alignItems={FlexBoxAlignItems.Center}
          direction={FlexBoxDirection.Column}
        >
          <Badge>height: 100px</Badge>
          <Text>This subcomponent will only be displayed below the second row.</Text>
        </FlexBox>
      );
    }
    if (row.id === '2') {
      return null;
    }
    return (
      <FlexBox
        style={{ backgroundColor: 'lightgrey', height: '50px' }}
        justifyContent={FlexBoxJustifyContent.Center}
        alignItems={FlexBoxAlignItems.Center}
        direction={FlexBoxDirection.Column}
      >
        <Badge>height: 50px</Badge>
        <Text>This subcomponent will be displayed below all rows except the first, second and third.</Text>
      </FlexBox>
    );
  };
  return (
    <AnalyticalTable
      data={props.data}
      columns={props.columns}
      renderRowSubComponent={renderRowSubComponent}
      alwaysShowSubComponent={false} //default value
    />
  );
};
```

</details>

## Adjust the number of visible rows to the container height

By adding the `visibleRowCountMode` prop and setting it to `AnalyticalTableVisibleRowCountMode.Auto` the table automatically fills the surrounding container with rows.

<ArgsTableWithNote story="Adjust number of rows to container height" hideHTMLPropsNote />

<Canvas withSource="none">
  <Story
    name="Adjust number of rows to container height"
    args={{ visibleRowCountMode: AnalyticalTableVisibleRowCountMode.Auto, containerHeight: 250 }}
    argTypes={{
      columns: { table: { disable: true } },
      data: { table: { disable: true } },
      header: { table: { disable: true } },
      headerRowHeight: { table: { disable: true } },
      extension: { table: { disable: true } },
      minRows: { table: { disable: true } },
      visibleRowCountMode: { table: { disable: true } },
      visibleRows: { table: { disable: true } },
      loading: { table: { disable: true } },
      noDataText: { table: { disable: true } },
      rowHeight: { table: { disable: true } },
      alternateRowColor: { table: { disable: true } },
      withRowHighlight: { table: { disable: true } },
      highlightField: { table: { disable: true } },
      filterable: { table: { disable: true } },
      sortable: { table: { disable: true } },
      groupable: { table: { disable: true } },
      groupBy: { table: { disable: true } },
      selectionBehavior: { table: { disable: true } },
      selectionMode: { table: { disable: true } },
      scaleWidthMode: { table: { disable: true } },
      columnOrder: { table: { disable: true } },
      infiniteScroll: { table: { disable: true } },
      infiniteScrollThreshold: { table: { disable: true } },
      onSort: { table: { disable: true } },
      onGroup: { table: { disable: true } },
      onRowSelect: { table: { disable: true } },
      onRowExpandChange: { table: { disable: true } },
      onColumnsReorder: { table: { disable: true } },
      onLoadMore: { table: { disable: true } },
      reactTableOptions: { table: { disable: true } },
      tableHooks: { table: { disable: true } },
      subRowsKey: { table: { disable: true } },
      selectedRowIds: { table: { disable: true } },
      isTreeTable: { table: { disable: true } },
      overscanCountHorizontal: { table: { disable: true } },
      overscanCount: { table: { disable: true } },
      renderRowSubComponent: { table: { disable: true } },
      alwaysShowSubComponent: { table: { disable: true } },
      NoDataComponent: { table: { disable: true } },
      LoadingComponent: { table: { disable: true } },
      style: { table: { disable: true } },
      className: { table: { disable: true } },
      tooltip: { table: { disable: true } },
      onRowClick: { table: { disable: true } },
      withNavigationHighlight: { table: { disable: true } },
      markNavigatedRow: { table: { disable: true } },
      globalFilterValue: { table: { disable: true } },
      tableInstance: { table: { disable: true } },
      portalContainer: { table: { disable: true } },
      adjustTableHeightOnPopIn: { table: { disable: true } },
      onTableScroll: { table: { disable: true } },
      showOverlay: { table: { disable: true } },
      scaleXFactor: { table: { disable: true } },
      retainColumnWidth: { table: { disable: true } },
      containerHeight: {
        options: [250, 500, 750, 1000],
        control: {
          type: 'radio'
        },
        description:
          'Select an option to change the height of the surrounding container of the table (in `px`). <br /> __Note__: This is not an actual prop of the table.'
      }
    }}
  >
    {(args) => {
      return (
        <div style={{ height: `${args.containerHeight}px` }}>
          <AnalyticalTable
            data={args.data}
            columns={args.columns}
            visibleRowCountMode={args.visibleRowCountMode}
            header={`Current height: ${args.containerHeight}px - Change the height in the table above`}
          />
        </div>
      );
    }}
  </Story>
</Canvas>

## Responsively display columns on small devices (Pop-In)

<ArgsTableWithNote story="Responsive columns" hideHTMLPropsNote />

To responsively hide columns or move content to the first column, you can add the `responsiveMinWidth` column option. If
you want the column to "pop-in" the `responsivePopIn` has to be set to `true`, otherwise the column will be hidden when the
`responsiveMinWidth` exceeds the table width. It's also possible to change the header of the pop-in column by setting the
`PopInHeader` option.

**Note:** It is recommended to offer column options such as filtering, sorting and grouping only for columns that are always displayed.

In the example below you can have a look at this behavior:

- `800`: The content of the "Action" column is moved to the first column (`responsiveMinWidth: 801`)
- `600`: The content of the "Age" column is moved to the first column (`responsiveMinWidth: 601`) and receives a custom header.
- `400`: The content of the "Friend Name" column is moved to the first column and the "Friend Age" column is hidden (`responsiveMinWidth: 401`). The "Friend Name" column also receives a custom header.

<Canvas withSource="none">
  <Story
    name="Responsive columns"
    args={{
      visibleRowCountMode: AnalyticalTableVisibleRowCountMode.Fixed,
      containerWidth: 'auto',
      data: dataSmall,
      columns: [
        {
          Header: 'Name',
          accessor: 'name'
        },
        {
          disableSortBy: true,
          responsivePopIn: true,
          responsiveMinWidth: 601,
          PopInHeader: 'Custom Header Text (age)',
          Header: 'Age',
          accessor: 'age'
        },
        {
          disableSortBy: true,
          responsivePopIn: true,
          responsiveMinWidth: 401,
          Header: 'Friend Name',
          PopInHeader: (instance) => {
            return <div style={{ color: 'red' }}>Friend Name (custom)</div>;
          },
          accessor: 'friend.name'
        },
        { disableSortBy: true, responsiveMinWidth: 401, Header: 'Friend Age', accessor: 'friend.age' },
        {
          disableSortBy: true,
          responsivePopIn: true,
          responsiveMinWidth: 801,
          id: 'actions',
          Header: 'Actions',
          width: 100,
          disableResizing: true,
          Cell: (instance) => {
            return (
              <FlexBox>
                <Button icon="edit" />
                <Button icon="delete" />
              </FlexBox>
            );
          }
        }
      ]
    }}
    argTypes={{
      columns: { table: { disable: true } },
      visibleRowCountMode: { table: { disable: true } },
      data: { table: { disable: true } },
      header: { table: { disable: true } },
      headerRowHeight: { table: { disable: true } },
      extension: { table: { disable: true } },
      minRows: { table: { disable: true } },
      visibleRows: { table: { disable: true } },
      loading: { table: { disable: true } },
      noDataText: { table: { disable: true } },
      rowHeight: { table: { disable: true } },
      alternateRowColor: { table: { disable: true } },
      withRowHighlight: { table: { disable: true } },
      highlightField: { table: { disable: true } },
      filterable: { table: { disable: true } },
      sortable: { table: { disable: true } },
      groupable: { table: { disable: true } },
      groupBy: { table: { disable: true } },
      selectionBehavior: { table: { disable: true } },
      selectionMode: { table: { disable: true } },
      scaleWidthMode: { table: { disable: true } },
      columnOrder: { table: { disable: true } },
      infiniteScroll: { table: { disable: true } },
      infiniteScrollThreshold: { table: { disable: true } },
      onSort: { table: { disable: true } },
      onGroup: { table: { disable: true } },
      onRowSelect: { table: { disable: true } },
      onRowExpandChange: { table: { disable: true } },
      onColumnsReorder: { table: { disable: true } },
      onLoadMore: { table: { disable: true } },
      reactTableOptions: { table: { disable: true } },
      tableHooks: { table: { disable: true } },
      subRowsKey: { table: { disable: true } },
      selectedRowIds: { table: { disable: true } },
      isTreeTable: { table: { disable: true } },
      overscanCountHorizontal: { table: { disable: true } },
      overscanCount: { table: { disable: true } },
      renderRowSubComponent: { table: { disable: true } },
      alwaysShowSubComponent: { table: { disable: true } },
      NoDataComponent: { table: { disable: true } },
      LoadingComponent: { table: { disable: true } },
      style: { table: { disable: true } },
      className: { table: { disable: true } },
      tooltip: { table: { disable: true } },
      onRowClick: { table: { disable: true } },
      withNavigationHighlight: { table: { disable: true } },
      markNavigatedRow: { table: { disable: true } },
      globalFilterValue: { table: { disable: true } },
      tableInstance: { table: { disable: true } },
      portalContainer: { table: { disable: true } },
      onTableScroll: { table: { disable: true } },
      showOverlay: { table: { disable: true } },
      scaleXFactor: { table: { disable: true } },
      retainColumnWidth: { table: { disable: true } },
      containerWidth: {
        options: [400, 600, 800, 'auto'],
        control: {
          type: 'radio'
        },
        description:
          'Select an option to change the width of the surrounding container of the table (in `px`). <br /> __Note__: This is not an actual prop of the table.'
      }
    }}
  >
    {(args) => {
      return (
        <div
          style={{
            width: args.containerWidth && typeof args.containerWidth === 'number' ? `${args.containerWidth}px` : 'auto'
          }}
        >
          <AnalyticalTable
            data={args.data}
            columns={args.columns}
            visibleRows={5}
            adjustTableHeightOnPopIn={args.adjustTableHeightOnPopIn}
            header={`Current width: ${args.containerWidth}`}
          />
        </div>
      );
    }}
  </Story>
</Canvas>

### Columns Config

```jsx
const COLUMNS = [
  {
    Header: 'Name',
    accessor: 'name'
  },
  {
    responsivePopIn: true,
    responsiveMinWidth: 601,
    PopInHeader: 'Custom Header Text (age)',
    Header: 'Age',
    accessor: 'age'
  },
  {
    responsivePopIn: true,
    responsiveMinWidth: 401,
    Header: 'Friend Name',
    PopInHeader: (instance) => {
      return <div style={{ color: 'red' }}>Friend Name (custom)</div>;
    },
    accessor: 'friend.name'
  },
  {
    responsiveMinWidth: 401,
    Header: 'Friend Age',
    accessor: 'friend.age'
  },
  {
    responsivePopIn: true,
    responsiveMinWidth: 801,
    id: 'actions',
    Header: 'Actions',
    width: 100,
    disableResizing: true,
    Cell: (instance) => {
      return (
        <FlexBox>
          <Button icon="edit" />
          <Button icon="delete" />
        </FlexBox>
      );
    }
  }
];
```

### How to change the content of the pop-in cell?

You can change the content of the pop-in cell without mutating the original cell by using the `isPopIn` prop of the table instance returned by the `Cell` column option:

```js
const COLUMNS = [
  {
    responsivePopIn: true,
    responsiveMinWidth: 600,
    id: 'col',
    Header: 'Column',
    Cell: ({ isPopIn }) => {
      if (isPopIn) {
        return 'pop-in content';
      }
      return 'original content';
    }
  },
  ...
];
```

## Display indicator for navigated rows

To display show the navigation column you need to set `withNavigationHighlight` to `true` and to mark a row as "navigated" the `markNavigatedRow` prop is required.
With the `markNavigatedRow` callback it is possible to define when and how many navigation indicators should be shown.

Click on any of the rows in the example below to display the "navigated" indicator in the navigation-column.

<Canvas withSource="none">
  <Story
    name="with navigation indicator"
    args={{ withNavigationHighlight: true, selectionMode: AnalyticalTableSelectionMode.MultiSelect, data: dataSmall }}
  >
    {(args) => {
      const [selectedRow, setSelectedRow] = useState();
      const onRowSelect = (e) => {
        setSelectedRow(e.detail.row);
      };
      const markNavigatedRow = useCallback(
        (row) => {
          return selectedRow?.id === row.id;
        },
        [selectedRow]
      );
      const [collapsed, setCollapsed] = useReducer((coll) => !coll, !isChromatic);
      return (
        <Panel collapsed={collapsed} onToggle={setCollapsed} headerText="Show table with navigation indicator">
          {collapsed ? (
            <BusyIndicator active style={{ width: '100%' }}>
              <span style={{ height: '580px' }} />
            </BusyIndicator>
          ) : (
            <AnalyticalTable
              data={args.data}
              columns={args.columns}
              withNavigationHighlight
              selectionMode={args.selectionMode}
              markNavigatedRow={markNavigatedRow}
              onRowSelect={onRowSelect}
            />
          )}
        </Panel>
      );
    }}
  </Story>
</Canvas>

### Code

```jsx
export const TableWithNavigationIndicators = () => {
  const [selectedRow, setSelectedRow] = useState();
  const onRowSelect = (e) => {
    setSelectedRow(e.detail.row);
  };
  const markNavigatedRow = useCallback(
    (row) => {
      return selectedRow?.id === row.id;
    },
    [selectedRow]
  );
  return (
    <AnalyticalTable
      data={data}
      columns={columns}
      withNavigationHighlight
      selectionMode={selectionMode}
      markNavigatedRow={markNavigatedRow}
      onRowSelect={onRowSelect}
    />
  );
};
```

## Custom column filtering

It is possible to define your own filter function and filter component on each column. For this you need to customize the column option `filter` or add a custom filter type to the `reactTableOptions.filterTypes` object (for a custom filter function) and the column option `Filter` (for a custom filter component).

Here you can find an example using a `MultiComboBox` with multiple values as filter.

<Canvas withSource="none">
  <Story name="with custom filter">
    {() => {
      const [collapsed, setCollapsed] = useReducer((coll) => !coll, !isChromatic);
      const filterFn = useCallback((rows, accessor, filterValue) => {
        if (filterValue.length > 0) {
          return rows.filter((row) => {
            const rowVal = row.values[accessor];
            return !!filterValue.some((item) => rowVal.includes(item));
          });
        }
        return rows;
      }, []);
      const columns = useMemo(
        () => [
          {
            Header: 'Custom Column Filter',
            accessor: 'name',
            filter: filterFn,
            Filter: ({ column }) => {
              const firstNames = ['Carl', 'Dan', 'Rose', 'Susanne'];
              return (
                <MultiComboBox
                  placeholder="Filter Names"
                  onSelectionChange={(e) => {
                    column.setFilter(e.detail.items.map((item) => item.getAttribute('text')));
                  }}
                >
                  {firstNames.map((item) => {
                    const isSelected = column?.filterValue?.some((filterVal) => filterVal.includes(item));
                    return <MultiComboBoxItem text={item} key={item} selected={isSelected} />;
                  })}
                </MultiComboBox>
              );
            }
          },
          {
            Header: 'Age',
            accessor: 'age'
          }
        ],
        []
      );
      return (
        <Panel collapsed={collapsed} onToggle={setCollapsed} headerText="Show table with custom column filter">
          {collapsed ? (
            <BusyIndicator active style={{ width: '100%' }}>
              <span style={{ height: '800px' }} />
            </BusyIndicator>
          ) : (
            <AnalyticalTable columns={columns} data={dataNameAge} filterable />
          )}
        </Panel>
      );
    }}
  </Story>
</Canvas>

### Code

<details>

<summary>Show Code</summary>

```jsx
const filterFn = (rows, accessor, filterValue) => {
  if (filterValue.length > 0) {
    return rows.filter((row) => {
      const rowVal = row.values[accessor];
      if (filterValue.some((item) => rowVal.includes(item))) {
        return true;
      }
      return false;
    });
  }
  return rows;
};
const COLUMNS = [
  {
    Header: 'Name',
    accessor: 'name',
    // either define your filter function here or set is as `reactTableOption` and pass the key as string here (see below)
    filter: filterFn,
    Filter: ({ column }) => {
      const firstNames = ['Carl', 'Dan', 'Rose', 'Susanne'];
      return (
        <MultiComboBox
          onSelectionChange={(e) => {
            column.setFilter(e.detail.items.map((item) => item.getAttribute('text')));
          }}
        >
          {firstNames.map((item) => {
            const isSelected = column?.filterValue?.some((filterVal) => filterVal.includes(item));
            return <MultiComboBoxItem text={item} key={item} selected={isSelected} />;
          })}
        </MultiComboBox>
      );
    }
  },
  {
    Header: 'Age',
    accessor: 'age'
  }
];
const TableComponent = () => {
  return (
    <ThemeProvider>
      <AnalyticalTable
        columns={COLUMNS}
        data={DATA}
        filterable
        // you can also define your function here, then you can just pass the key as string to the `filter` column option
        // reactTableOptions={{
        //   filterTypes: {
        //     multiValueFilter: filterFn
        //   }
        // }}
      />
    </ThemeProvider>
  );
};
```

</details>

<Footer style={{ marginTop: '2rem' }} />
