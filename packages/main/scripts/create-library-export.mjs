import path from 'path';
import fs from 'fs';
import PATHS from '../../../config/paths.js';

const LIB_BASE_PATH = path.resolve(PATHS.packages, 'main', 'src', 'lib');
const INTERNAL_COMPONENTS = ['ScrollContext'];

const allLibFiles = fs
  .readdirSync(LIB_BASE_PATH)
  .filter((file) => fs.statSync(`${LIB_BASE_PATH}/${file}`).isFile())
  .map((file) => path.basename(file, '.ts'))
  // filter internal components
  .filter((file) => !INTERNAL_COMPONENTS.includes(file));

let fileContent = `// This is an autogenerated file, please do not modify this file manually.
// All exported modules have to be made available via the /lib folder.
// In case you added a new file to the /lib folder, pleas rerun the scripts/create-library-export.js script.
`;

console.log(allLibFiles);

allLibFiles.forEach((file) => {
  fileContent += `
import { ${file} } from './lib/${file}';`;
});

fileContent += `

export {
  `;
fileContent += allLibFiles.join(',\n  ');
fileContent += `
};
`;

fs.writeFileSync(
  path.join(PATHS.packages, 'main', 'src', 'index.ts'),
  fileContent
);
